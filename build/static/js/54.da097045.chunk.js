(this["webpackJsonpbarnbridge-frontend"]=this["webpackJsonpbarnbridge-frontend"]||[]).push([[54],{1454:function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"c",(function(){return P}));var r,o=n(0),a=n(19),c=n.n(a),i=n(66),s=n(45),u=n(186),h=n(5),d=n(29),l=n(14),f=n(16),p=n(23),b=n(24),v=n(9),m=n.n(v),E=n(37),O=[Object(E.c)("NR_OF_EPOCHS",[],["uint256"]),Object(E.c)("TOTAL_DISTRIBUTED_AMOUNT",[],["uint256"]),Object(E.c)("epochStart",[],["uint256"]),Object(E.c)("epochDuration",[],["uint256"]),Object(E.c)("getCurrentEpoch",[],["uint256"]),Object(E.c)("getPoolSize",["uint128"],["uint256"]),Object(E.c)("getEpochStake",["address","uint128"],["uint256"]),Object(E.c)("massHarvest",[],["uint256"])],j=function(t){Object(p.a)(n,t);var e=Object(b.a)(n);function n(t){var r;return Object(l.a)(this,n),(r=e.call(this,O,t,"YIELD FARM")).totalEpochs=void 0,r.totalSupply=void 0,r.epochDuration=void 0,r.epoch1Start=void 0,r.currentEpoch=void 0,r.poolSize=void 0,r.userStaked=void 0,r.toClaim=void 0,r.on(E.d.UPDATE_ACCOUNT,(function(){r.userStaked=void 0,r.toClaim=void 0,r.emit(E.d.UPDATE_DATA)})),r}return Object(f.a)(n,[{key:"lastActiveEpoch",get:function(){if(void 0!==this.currentEpoch&&void 0!==this.totalEpochs)return Math.min(this.currentEpoch,this.totalEpochs)}},{key:"isPoolEnded",get:function(){if(void 0!==this.currentEpoch&&void 0!==this.totalEpochs)return this.currentEpoch>this.totalEpochs}},{key:"poolEndDate",get:function(){if(void 0!==this.epoch1Start&&void 0!==this.totalEpochs&&void 0!==this.epochDuration)return this.epoch1Start+this.totalEpochs*this.epochDuration}},{key:"epochReward",get:function(){if(void 0!==this.totalSupply&&void 0!==this.totalEpochs&&0!==this.totalEpochs)return this.totalSupply/this.totalEpochs}},{key:"potentialReward",get:function(){if(this.isPoolEnded)return c.a.ZERO;var t=this.epochReward;return void 0===this.poolSize||this.poolSize.isEqualTo(c.a.ZERO)||void 0===this.userStaked||void 0===t?void 0:this.userStaked.dividedBy(this.poolSize).multipliedBy(t)}},{key:"distributedReward",get:function(){var t=this.lastActiveEpoch,e=this.epochReward;if(void 0!==t&&void 0!==e)return e*(t===this.totalEpochs?t:t-1)}},{key:"loadCommon",value:function(){var t=Object(d.a)(m.a.mark((function t(){var e,n,r,o,a,i,s,u,d,l;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.batch([{method:"NR_OF_EPOCHS"},{method:"TOTAL_DISTRIBUTED_AMOUNT"},{method:"epochDuration"},{method:"epochStart"},{method:"getCurrentEpoch"}]);case 2:return e=t.sent,n=Object(h.a)(e,5),r=n[0],o=n[1],a=n[2],i=n[3],s=n[4],this.totalEpochs=Number(r),this.totalSupply=Number(o),this.epochDuration=Number(a),this.epoch1Start=Number(i),this.currentEpoch=Number(s),this.emit(E.d.UPDATE_DATA),t.next=17,this.batch([{method:"getPoolSize",methodArgs:[this.currentEpoch]}]);case 17:u=t.sent,d=Object(h.a)(u,1),l=d[0],this.poolSize=c.a.from(l),this.emit(E.d.UPDATE_DATA);case 22:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"loadUserData",value:function(){var t=Object(d.a)(m.a.mark((function t(){var e,n,r,o,a,i;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.account,this.assertAccount(),t.next=4,this.batch([{method:"getCurrentEpoch"}]);case 4:return n=t.sent,this.currentEpoch=Number(n),t.next=8,this.batch([{method:"getEpochStake",methodArgs:[e,this.currentEpoch]},{method:"massHarvest",callArgs:{from:e}}]);case 8:r=t.sent,o=Object(h.a)(r,2),a=o[0],i=o[1],this.userStaked=c.a.from(a),this.toClaim=c.a.from(i),this.emit(E.d.UPDATE_DATA);case 15:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"claim",value:function(){var t=Object(d.a)(m.a.mark((function t(e){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.send("massHarvest",[],{},e);case 2:return n=t.sent,t.abrupt("return",c.a.from(n));case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),n}(E.d),k=n(4),g=[Object(E.c)("epoch1Start",[],["uint256"]),Object(E.c)("epochDuration",[],["uint256"]),Object(E.c)("getCurrentEpoch",[],["uint128"]),Object(E.c)("getEpochPoolSize",["address","uint128"],["uint256"]),Object(E.c)("getEpochUserBalance",["address","address","uint128"],["uint256"]),Object(E.c)("balanceOf",["address","address"],["uint256"]),Object(E.c)("deposit",["address","uint256"],[]),Object(E.c)("withdraw",["address","uint256"],[])],S=function(t){Object(p.a)(n,t);var e=Object(b.a)(n);function n(t){var r;return Object(l.a)(this,n),(r=e.call(this,g,t,"YF STAKING")).currentEpoch=void 0,r.epochStart=void 0,r.epochDuration=void 0,r.stakedTokens=void 0,r.stakedTokens=new Map,r.on(E.d.UPDATE_ACCOUNT,(function(){r.stakedTokens.forEach((function(t){t.currentEpochUserBalance=void 0,t.nextEpochUserBalance=void 0})),r.emit(E.d.UPDATE_DATA)})),r}return Object(f.a)(n,[{key:"epochDates",get:function(){if(this.epochStart&&this.currentEpoch&&this.epochDuration){var t=1e3*(this.epochStart+(this.currentEpoch-1)*this.epochDuration);return[t,1e3*(this.epochStart+this.currentEpoch*this.epochDuration),(Date.now()-t)/(1e3*this.epochDuration)*100]}}},{key:"loadCommonFor",value:function(){var t=Object(d.a)(m.a.mark((function t(e){var n,r,o,a,i,s,u,d,l,f,p;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.batch([{method:"getCurrentEpoch"},{method:"epoch1Start"},{method:"epochDuration"}]);case 2:return n=t.sent,r=Object(h.a)(n,3),o=r[0],a=r[1],i=r[2],s=this.currentEpoch=Number(o),this.epochStart=Number(a),this.epochDuration=Number(i),t.next=12,this.batch([{method:"getEpochPoolSize",methodArgs:[e,s]},{method:"getEpochPoolSize",methodArgs:[e,s+1]}]);case 12:u=t.sent,d=Object(h.a)(u,2),l=d[0],f=d[1],p=Object(k.a)(Object(k.a)({},this.stakedTokens.get(e)),{},{currentEpochPoolSize:c.a.from(l),nextEpochPoolSize:c.a.from(f)}),this.stakedTokens.set(e,p),this.emit(E.d.UPDATE_DATA);case 19:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"loadUserDataFor",value:function(){var t=Object(d.a)(m.a.mark((function t(e){var n,r,o,a,i,s,u,d,l,f,p;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.account,this.assertAccount(),t.next=4,this.batch([{method:"getCurrentEpoch"}]);case 4:return r=t.sent,o=Object(h.a)(r,1),a=o[0],i=this.currentEpoch=Number(a),t.next=10,this.batch([{method:"balanceOf",methodArgs:[n,e]},{method:"getEpochUserBalance",methodArgs:[n,e,i]},{method:"getEpochUserBalance",methodArgs:[n,e,i+1]}]);case 10:s=t.sent,u=Object(h.a)(s,3),d=u[0],l=u[1],f=u[2],p=Object(k.a)(Object(k.a)({},this.stakedTokens.get(e)),{},{userBalance:c.a.from(d),currentEpochUserBalance:c.a.from(l),nextEpochUserBalance:c.a.from(f)}),this.stakedTokens.set(e,p),this.emit(E.d.UPDATE_DATA);case 18:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"stake",value:function(){var t=Object(d.a)(m.a.mark((function t(e,n,r){var o;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.send("deposit",[e,n],{},r);case 2:return o=t.sent,t.abrupt("return",c.a.from(o));case 4:case"end":return t.stop()}}),t,this)})));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"unstake",value:function(){var t=Object(d.a)(m.a.mark((function t(e,n,r){var o;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.send("withdraw",[e,n],{},r);case 2:return o=t.sent,t.abrupt("return",c.a.from(o));case 4:case"end":return t.stop()}}),t,this)})));return function(e,n,r){return t.apply(this,arguments)}}()}]),n}(E.d),D=n(73),T=n(59),y=n(1);!function(t){t.STABLE="stable",t.UNILP="unilp",t.BOND="bond"}(r||(r={}));var A=Object(o.createContext)(Object(T.a)("YfPoolsProvider"));function P(){return Object(o.useContext)(A)}function U(t){return Object(i.b)(t,(function(){return new j(t)}))}e.b=function(t){var e,n,a,h,d,l=t.children,f=Object(s.b)(),p=Object(D.c)(),b=Object(u.c)(),v=b.usdcToken,m=b.daiToken,E=b.susdToken,O=b.univ2Token,j=b.bondToken,k=b.convertTokenInUSD,g=(d=null===(e=f.contracts.yf)||void 0===e?void 0:e.staking,Object(i.b)(d,(function(){return new S(d)}))),T=U(null===(n=f.contracts.yf)||void 0===n?void 0:n.stable),P=U(null===(a=f.contracts.yf)||void 0===a?void 0:a.unilp),x=U(null===(h=f.contracts.yf)||void 0===h?void 0:h.bond),w=Object(o.useMemo)((function(){return[{name:r.STABLE,label:"USDC/DAI/sUSD",tokens:[v,m,E],contract:T},{name:r.UNILP,label:"USDC_BOND_UNI_LP",tokens:[O],contract:P},{name:r.BOND,label:"BOND",tokens:[j],contract:x}]}),[x,T,P]);Object(o.useEffect)((function(){w.forEach((function(t){t.contract.loadCommon().catch(Error),t.tokens.forEach((function(t){g.loadCommonFor(t.address).catch(Error)}))}))}),[w,g]),Object(o.useEffect)((function(){p.account&&w.forEach((function(t){t.contract.loadUserData().catch(Error),t.tokens.forEach((function(t){g.loadUserDataFor(t.address).catch(Error)}))}))}),[p.account,w,g]);var C=Object(o.useCallback)((function(t){return w.find((function(e){return e.name===t}))}),[w]),B=Object(o.useCallback)((function(t){var e=C(t);if(e)return c.a.sumEach(e.tokens,(function(t){var e=g.stakedTokens.get(t.address);if(e&&void 0!==e.nextEpochPoolSize)return k(e.nextEpochPoolSize.unscaleBy(t.decimals),t.symbol)}))}),[C,g.stakedTokens]),_=Object(o.useCallback)((function(t){var e=C(t);if(e)return c.a.sumEach(e.tokens,(function(t){var e=g.stakedTokens.get(t.address);if(e&&void 0!==e.currentEpochPoolSize)return k(e.currentEpochPoolSize.unscaleBy(t.decimals),t.symbol)}))}),[C,g.stakedTokens]),I=Object(o.useCallback)((function(t){var e=C(t);if(e)return c.a.sumEach(e.tokens,(function(t){var e=g.stakedTokens.get(t.address);if(e&&void 0!==e.nextEpochUserBalance)return k(e.nextEpochUserBalance.unscaleBy(t.decimals),t.symbol)}))}),[C,g.stakedTokens]),N=Object(o.useCallback)((function(t){var e=C(t);if(e)return c.a.sumEach(e.tokens,(function(t){var e=g.stakedTokens.get(t.address);if(e&&void 0!==e.currentEpochUserBalance)return k(e.currentEpochUserBalance.unscaleBy(t.decimals),t.symbol)}))}),[C,g.stakedTokens]),z=Object(o.useCallback)((function(){return c.a.sumEach(w,(function(t){return B(t.name)}))}),[w,B]),R=Object(o.useCallback)((function(){return c.a.sumEach(w,(function(t){return _(t.name)}))}),[w,_]),F=Object(o.useCallback)((function(){return c.a.sumEach(w,(function(t){var e=t.contract.distributedReward;if(void 0!==e)return c.a.from(e)}))}),[w]),M=Object(o.useCallback)((function(){return c.a.sumEach(w,(function(t){var e=t.contract.totalSupply;if(void 0!==e)return c.a.from(e)}))}),[w]),Y={yfPools:w,getYFKnownPoolByName:C,stakingContract:g,getYFTotalStakedInUSD:z,getYFTotalEffectiveStakedInUSD:R,getPoolBalanceInUSD:B,getPoolEffectiveBalanceInUSD:_,getMyPoolBalanceInUSD:I,getMyPoolEffectiveBalanceInUSD:N,getYFDistributedRewards:F,getYFTotalSupply:M};return Object(y.jsx)(A.Provider,{value:Y,children:l})}},1708:function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"c",(function(){return f}));var r,o=n(4),a=n(0),c=n(19),i=n.n(c),s=n(45),u=n(59),h=n(71),d=n(1);!function(t){t.DEPOSIT="DEPOSIT",t.WITHDRAW="WITHDRAW"}(r||(r={}));var l=Object(a.createContext)(Object(u.a)("YfAPIProvider"));function f(){return Object(a.useContext)(l)}e.b=function(t){var e=Object(s.b)();var n={fetchYFPoolTransactions:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"all",c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"all",s=Object(h.c)({page:String(t),limit:String(n),userAddress:a,actionType:c,tokenAddress:r}),u=new URL("/api/yieldfarming/staking-actions/list?".concat(s),e.api.baseUrl);return fetch(u.toString()).then((function(t){return t.json()})).then((function(t){return 200!==t.status?Promise.reject(new Error(t.data)):t})).then((function(t){var e;return Object(o.a)(Object(o.a)({},t),{},{data:(null!==(e=t.data)&&void 0!==e?e:[]).map((function(t){return Object(o.a)(Object(o.a)({},t),{},{amount:new i.a(t.amount)})}))})}))},fetchYFPoolChart:function(t,n,r,o){var a=Object(h.c)({tokenAddress:t,start:n,end:r,scale:o}),c=new URL("/api/yieldfarming/staking-actions/chart?".concat(a),e.api.baseUrl);return fetch(c.toString()).then((function(t){return t.json()})).then((function(t){return 200!==t.status?Promise.reject(new Error(t.data)):t.data}))}};return Object(d.jsx)(l.Provider,{value:n,children:t.children})}},2274:function(t,e,n){"use strict";n.r(e);var r=n(0),o=n(226),a=n(56),c=n(249),i=n.n(c),s=n(617),u=n(1708),h=n(1454),d=n(1),l=Object(r.lazy)((function(){return Promise.all([n.e(0),n.e(1),n.e(3),n.e(4),n.e(28)]).then(n.bind(null,2245))})),f=Object(r.lazy)((function(){return Promise.all([n.e(0),n.e(1),n.e(2),n.e(4),n.e(30)]).then(n.bind(null,2246))}));e.default=function(){var t=Object(s.b)();return Object(r.useEffect)((function(){var e;return e=o.isMobile?t.addWarn({text:"Transactions can only be made from the desktop version using Metamask",closable:!0,storageIdentity:"bb_desktop_metamask_tx_warn"}):t.addWarn({text:"Do not send funds directly to the contract!",closable:!0,storageIdentity:"bb_send_funds_warn"}),function(){var t;null===(t=e)||void 0===t||t()}}),[o.isMobile]),Object(d.jsx)(u.b,{children:Object(d.jsx)(h.b,{children:Object(d.jsx)(r.Suspense,{fallback:Object(d.jsx)(i.a,{}),children:Object(d.jsxs)(a.d,{children:[Object(d.jsx)(a.b,{path:"/yield-farming",exact:!0,component:l}),Object(d.jsx)(a.b,{path:"/yield-farming/:poolId",exact:!0,component:f}),Object(d.jsx)(a.a,{to:"/yield-farming"})]})})})})}}}]);
//# sourceMappingURL=54.da097045.chunk.js.map
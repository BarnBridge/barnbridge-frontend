{"version":3,"sources":["modules/smart-alpha/views/withdraw-view/withdrawForm.tsx","modules/smart-alpha/views/withdraw-view/index.tsx"],"names":["WithdrawForm","pool","tokenContract","tranche","useParams","toLowerCase","contracts","useConfig","wallet","useWallet","useTokens","getToken","getAsset","useReload","reload","version","useState","tokenState","setTokenState","withdrawQueueBalance","setWithdrawQueueBalance","unclaimedUnderlying","setUnclaimedUnderlying","saving","setSaving","confirmModalVisible","setConfirmModalVisible","isSenior","poolToken","symbol","oracleToken","oracleAssetSymbol","tokenMax","balance","unscaleBy","decimals","useContractFactory","getOrCreateContract","Listeners","smartAlphaContract","useMemo","poolAddress","SmartAlphaContract","afterInit","contract","a","loadCommon","loupeContract","loupeAddress","sa","loupe","LoupeContract","gasPrice","amount","BigNumber","from","scaleBy","withdrawSenior","withdrawJunior","call","loadBalance","console","error","useEffect","account","seniorExitQueue","juniorExitQueue","then","getUserRedeemableSeniorUnderlying","getUserRedeemableJuniorUnderlying","address","className","type","weight","color","tag","classNames","s","depositBalance","text","formatToken","name","icon","outline","bubble1Name","bubble2Name","size","before","value","onChange","slider","max","placeholder","variation","disabled","onClick","title","header","tokenName","submitText","onCancel","onConfirm","handleWithdraw","WithdrawView","id","useFetchPool","data","seniorTokenAddress","juniorTokenAddress","Erc20Contract","Promise","all","style","margin","to","iconPosition","iconRotate","poolName","state","epoch","path"],"mappings":"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","file":"static/js/sa-withdraw-view.5df9bb98.chunk.js","sourcesContent":["import { useEffect, useMemo, useState } from 'react';\nimport { useParams } from 'react-router-dom';\nimport BigNumber from 'bignumber.js';\nimport classNames from 'classnames';\nimport TxConfirmModal from 'web3/components/tx-confirm-modal';\nimport Erc20Contract from 'web3/erc20Contract';\nimport { formatToken } from 'web3/utils';\n\nimport { Alert } from 'components/alert';\nimport { Button } from 'components/button';\nimport { Spinner } from 'components/custom/spinner';\nimport { TokenAmount } from 'components/custom/token-amount-new';\nimport { Hint, Text } from 'components/custom/typography';\nimport { useConfig } from 'components/providers/configProvider';\nimport { useTokens } from 'components/providers/tokensProvider';\nimport { TokenIcon } from 'components/token-icon';\nimport { useContractFactory } from 'hooks/useContract';\nimport { useReload } from 'hooks/useReload';\nimport { PoolApiType } from 'modules/smart-alpha/api';\nimport LoupeContract from 'modules/smart-alpha/contracts/loupeContract';\nimport SmartAlphaContract from 'modules/smart-alpha/contracts/smartAlphaContract';\nimport { useWallet } from 'wallets/walletProvider';\n\nimport s from 'modules/smart-alpha/views/deposit-view/s.module.scss';\n\ntype Props = {\n  pool: PoolApiType;\n  tokenContract: Erc20Contract | undefined;\n};\n\nexport const WithdrawForm = ({ pool, tokenContract }: Props) => {\n  const params = useParams<{ tranche: 'senior' | 'junior' }>();\n  const tranche = params.tranche.toLowerCase();\n\n  const { contracts } = useConfig();\n  const wallet = useWallet();\n  const { getToken, getAsset } = useTokens();\n  const [reload, version] = useReload();\n\n  const [tokenState, setTokenState] = useState('');\n  const [withdrawQueueBalance, setWithdrawQueueBalance] = useState<BigNumber | undefined>();\n  const [unclaimedUnderlying, setUnclaimedUnderlying] = useState<BigNumber | undefined>();\n  const [saving, setSaving] = useState(false);\n  const [confirmModalVisible, setConfirmModalVisible] = useState(false);\n\n  const isSenior = tranche === 'senior';\n  const poolToken = getToken(pool.poolToken.symbol);\n  const oracleToken = getAsset(pool.oracleAssetSymbol);\n  const tokenMax = tokenContract?.balance?.unscaleBy(pool.poolToken.decimals) ?? 0;\n\n  const { getOrCreateContract, Listeners } = useContractFactory();\n\n  const smartAlphaContract = useMemo(() => {\n    if (!pool) {\n      return undefined;\n    }\n\n    return getOrCreateContract(\n      pool.poolAddress,\n      () => {\n        return new SmartAlphaContract(pool.poolAddress);\n      },\n      {\n        afterInit: async contract => {\n          await contract.loadCommon();\n        },\n      },\n    );\n  }, [pool]);\n\n  const loupeContract = useMemo<LoupeContract | undefined>(() => {\n    const loupeAddress = contracts.sa?.loupe;\n\n    if (!loupeAddress) {\n      return undefined;\n    }\n\n    return getOrCreateContract(loupeAddress, () => {\n      return new LoupeContract(loupeAddress);\n    });\n  }, [contracts.sa?.loupe]);\n\n  useEffect(() => {\n    if (!wallet.account) {\n      return;\n    }\n\n    (isSenior ? smartAlphaContract?.seniorExitQueue : smartAlphaContract?.juniorExitQueue)\n      ?.call(smartAlphaContract, wallet.account)\n      .then(([epoch, amount]) => {\n        setWithdrawQueueBalance(amount);\n      });\n\n    (isSenior ? loupeContract?.getUserRedeemableSeniorUnderlying : loupeContract?.getUserRedeemableJuniorUnderlying)\n      ?.call(loupeContract, smartAlphaContract?.address!, wallet.account)\n      .then(amount => {\n        setUnclaimedUnderlying(amount);\n      });\n  }, [wallet.account, version]);\n\n  async function handleWithdraw(gasPrice?: number) {\n    setConfirmModalVisible(false);\n    setSaving(true);\n\n    try {\n      const amount = BigNumber.from(tokenState)?.scaleBy(pool.poolToken.decimals);\n\n      if (amount) {\n        await (isSenior ? smartAlphaContract?.withdrawSenior : smartAlphaContract?.withdrawJunior)?.call(\n          smartAlphaContract,\n          amount,\n          gasPrice,\n        );\n        await tokenContract?.loadBalance();\n        setTokenState('');\n        reload();\n      }\n    } catch (e) {\n      console.error(e);\n    }\n\n    setSaving(false);\n  }\n\n  return (\n    <div className=\"card p-24\">\n      <Text type=\"h3\" weight=\"bold\" color=\"primary\" tag=\"h3\" className=\"mb-16\">\n        {isSenior ? 'Senior' : 'Junior'} withdraw\n      </Text>\n      <Text type=\"p2\" weight=\"semibold\" color=\"secondary\" tag=\"p\" className=\"mb-32\">\n        Choose the amount of tokens you want to withdraw from the {tranche} side. Make sure you double check the\n        amounts.\n      </Text>\n\n      <div className={classNames(s.depositBalance, 'flex col-gap-32 mb-32')}>\n        <div>\n          <Hint\n            text=\"This amount of junior/senior tokens is already in the withdrawal queue and will be subtracted from your overall position in the next epoch.\"\n            className=\"mb-4\">\n            <Text type=\"small\" weight=\"semibold\" color=\"secondary\">\n              Balance in withdraw queue\n            </Text>\n          </Hint>\n          <Text type=\"p1\" weight=\"semibold\" color=\"primary\" className=\"flex align-center\">\n            {formatToken(withdrawQueueBalance?.unscaleBy(pool.poolToken.decimals)) ?? '-'}\n            <TokenIcon\n              name={poolToken?.icon}\n              outline={isSenior ? 'green' : 'purple'}\n              bubble1Name=\"bond\"\n              bubble2Name={oracleToken?.icon}\n              size={16}\n              className=\"ml-8\"\n            />\n          </Text>\n        </div>\n        <div>\n          <Hint\n            text={`This amount of ${poolToken?.icon} is available to be redeemed from withdrawals made in previous epochs. It will be automatically redeemed if you add more junior/senior tokens to the withdrawal queue.`}\n            className=\"mb-4\">\n            <Text type=\"small\" weight=\"semibold\" color=\"secondary\">\n              Unclaimed {tranche} tokens\n            </Text>\n          </Hint>\n          <Text type=\"p1\" weight=\"semibold\" color=\"primary\" className=\"flex align-center\">\n            {formatToken(unclaimedUnderlying?.unscaleBy(pool.poolToken.decimals)) ?? '-'}\n            <TokenIcon name={poolToken?.icon} size={16} className=\"ml-8\" />\n          </Text>\n        </div>\n      </div>\n\n      <Text type=\"small\" weight=\"semibold\" color=\"secondary\" className=\"mb-8\">\n        {tokenContract?.symbol ?? '-'} amount\n      </Text>\n      <TokenAmount\n        before={\n          <TokenIcon\n            name={poolToken?.icon}\n            bubble1Name=\"bond\"\n            bubble2Name={oracleToken?.icon}\n            outline={isSenior ? 'green' : 'purple'}\n            size={24}\n          />\n        }\n        value={tokenState}\n        onChange={setTokenState}\n        slider\n        max={tokenMax}\n        placeholder={`0 (Max ${tokenMax ?? 0})`}\n        className=\"mb-32\"\n      />\n\n      <Alert type=\"info\" className=\"mb-32\">\n        Withdrawals made during an epoch will be added to the withdrawal queue and subtracted from your overall position\n        in the next epoch.\n      </Alert>\n\n      <div className=\"flex justify-end align-center\">\n        <Button\n          variation=\"primary\"\n          disabled={saving}\n          onClick={() => {\n            setConfirmModalVisible(true);\n          }}>\n          {saving && <Spinner className=\"mr-8\" />}\n          Signal withdraw\n        </Button>\n      </div>\n\n      {confirmModalVisible && (\n        <TxConfirmModal\n          title=\"Initiate withdrawal\"\n          header={\n            <div className=\"flex flow-row row-gap-16\">\n              <Text type=\"p2\" weight=\"semibold\" color=\"secondary\">\n                Your balance of{' '}\n                <Text tag=\"span\" type=\"p2\" weight=\"bold\" color=\"primary\">\n                  {formatToken(BigNumber.from(tokenState), {\n                    tokenName: tokenContract?.symbol,\n                  })}\n                </Text>{' '}\n                will be added to the exit queue. You can come back at the end of the epoch to redeem your underlying\n                token\n              </Text>\n              <div className=\"container-box flex flow-col col-gap-32\">\n                <div className=\"flex flow-row\">\n                  <Text type=\"small\" weight=\"semibold\" color=\"secondary\" className=\"mb-4\">\n                    Withdraw amount\n                  </Text>\n                  <Text type=\"p1\" weight=\"semibold\" color=\"primary\" className=\"flex align-center\">\n                    {formatToken(BigNumber.from(tokenState)) ?? '-'}\n                    <TokenIcon\n                      name={poolToken?.icon}\n                      bubble1Name=\"bond\"\n                      bubble2Name={oracleToken?.icon}\n                      outline={isSenior ? 'green' : 'purple'}\n                      className=\"ml-8\"\n                    />\n                  </Text>\n                </div>\n                <div className=\"flex flow-row\">\n                  <Text type=\"small\" weight=\"semibold\" color=\"secondary\" className=\"mb-4\">\n                    Redeemable unclaimed underlying\n                  </Text>\n                  <Text type=\"p1\" weight=\"semibold\" color=\"primary\" className=\"flex align-center\">\n                    {formatToken(unclaimedUnderlying?.unscaleBy(pool.poolToken.decimals)) ?? '-'}\n                    <TokenIcon name={poolToken?.icon} size={16} className=\"ml-8\" />\n                  </Text>\n                </div>\n              </div>\n            </div>\n          }\n          submitText=\"Initiate withdraw\"\n          onCancel={() => setConfirmModalVisible(false)}\n          onConfirm={({ gasPrice }) => handleWithdraw(gasPrice)}\n        />\n      )}\n      {Listeners}\n    </div>\n  );\n};\n","import { useMemo } from 'react';\nimport { Route, Switch, useParams } from 'react-router-dom';\nimport Erc20Contract from 'web3/erc20Contract';\nimport { formatToken } from 'web3/utils';\n\nimport { Link } from 'components/button';\nimport { Spinner } from 'components/custom/spinner';\nimport { Text } from 'components/custom/typography';\nimport { useTokens } from 'components/providers/tokensProvider';\nimport { TokenIcon } from 'components/token-icon';\nimport { useContractFactory } from 'hooks/useContract';\nimport { useFetchPool } from 'modules/smart-alpha/api';\nimport { WithdrawForm } from 'modules/smart-alpha/views/withdraw-view/withdrawForm';\n\nconst WithdrawView = () => {\n  const { id: poolAddress, tranche } = useParams<{ id: string; tranche: 'senior' | 'junior' }>();\n  const { data: pool } = useFetchPool(poolAddress);\n  const { getToken, getAsset } = useTokens();\n\n  const isSenior = tranche === 'senior';\n\n  const { getOrCreateContract } = useContractFactory();\n\n  const tokenContract = useMemo(() => {\n    if (!pool) {\n      return undefined;\n    }\n\n    const address = isSenior ? pool.seniorTokenAddress : pool.juniorTokenAddress;\n    return getOrCreateContract(\n      address,\n      () => {\n        return new Erc20Contract([], address);\n      },\n      {\n        afterInit: async contract => {\n          await Promise.all([contract.loadCommon(), contract.loadBalance()]);\n        },\n      },\n    );\n  }, [pool, isSenior]);\n\n  if (!pool) {\n    return <Spinner style={{ margin: 'auto' }} />;\n  }\n\n  const poolToken = getToken(pool.poolToken.symbol);\n  const oracleToken = getAsset(pool.oracleAssetSymbol);\n\n  return (\n    <>\n      <div className=\"container-fit\">\n        <Link\n          to={`/smart-alpha/portfolio/${tranche}?poolAddress=${poolAddress}`}\n          variation=\"text-alt\"\n          icon=\"arrow\"\n          iconPosition=\"left\"\n          iconRotate={180}\n          className=\"mb-16\">\n          Portfolio\n        </Link>\n        <div className=\"flex col-gap-64 align-center mb-32\">\n          <div className=\"flex align-center\">\n            <TokenIcon name={poolToken?.icon} size={40} bubble2Name={oracleToken?.icon} className=\"mr-16\" />\n            <div>\n              <Text type=\"p1\" weight=\"semibold\" color=\"primary\" tag=\"h2\" className=\"mb-4\">\n                {pool.poolName}\n              </Text>\n              <Text type=\"small\" weight=\"semibold\" color=\"red\">\n                Epoch {pool.state.epoch}\n              </Text>\n            </div>\n          </div>\n          <div>\n            <Text type=\"small\" weight=\"semibold\" color=\"secondary\" className=\"mb-4\">\n              Wallet balance\n            </Text>\n            <div className=\"flex align-center\">\n              <Text type=\"p1\" weight=\"semibold\" color=\"primary\" className=\"mr-4\">\n                {formatToken(tokenContract?.balance?.unscaleBy(pool.poolToken.decimals)) ?? '-'}\n              </Text>\n              <Text type=\"small\" weight=\"semibold\" color=\"secondary\">\n                {tokenContract?.symbol ?? '-'}\n              </Text>\n            </div>\n          </div>\n          <Switch>\n            <Route path=\"/smart-alpha/pools/:id/deposit/senior\">\n              <div>\n                <Text type=\"small\" weight=\"semibold\" color=\"secondary\" className=\"mb-4\">\n                  Side\n                </Text>\n                <Text type=\"p1\" weight=\"semibold\" color=\"primary\" className=\"mr-4\">\n                  Senior\n                </Text>\n              </div>\n            </Route>\n            <Route path=\"/smart-alpha/pools/:id/deposit/junior\">\n              <div>\n                <Text type=\"small\" weight=\"semibold\" color=\"secondary\" className=\"mb-4\">\n                  Side\n                </Text>\n                <Text type=\"p1\" weight=\"semibold\" color=\"primary\" className=\"mr-4\">\n                  Junior\n                </Text>\n              </div>\n            </Route>\n          </Switch>\n        </div>\n        <WithdrawForm pool={pool} tokenContract={tokenContract} />\n      </div>\n    </>\n  );\n};\n\nexport default WithdrawView;\n"],"sourceRoot":""}
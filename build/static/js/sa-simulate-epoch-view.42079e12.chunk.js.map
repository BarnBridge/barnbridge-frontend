{"version":3,"sources":["hooks/useContract.tsx","components/antd/spin/index.tsx","components/antd/spin/s.module.scss","modules/smart-alpha/contracts/smartAlphaContract.ts","components/custom/tooltip/index.tsx","components/custom/form/index.tsx","components/custom/form/s.module.scss","components/input/index.tsx","components/input/s.module.scss","modules/smart-alpha/views/simulate-epoch/s.module.scss","modules/smart-alpha/contracts/accountingModelContract.ts","modules/smart-alpha/contracts/seniorRateModelContract.ts","modules/smart-alpha/views/simulate-epoch/simulate.tsx","modules/smart-alpha/views/simulate-epoch/index.tsx"],"names":["useDeepCompareMemoize","value","ref","useRef","isEqual","current","useContract","address","loadBalance","loadCommon","loadAllowance","useWallet","provider","account","useReload","reload","useContractManager","getContract","contract","useMemo","Erc20Contract","on","Web3Contract","UPDATE_DATA","useEffect","setAccount","then","catch","Error","memoisedAllowance","Array","isArray","forEach","i","useContractFactory","options","listeners","walletProvider","activeProvider","useWeb3","version","activeProviderRef","walletProviderRef","accountRef","contractsRef","Map","createContract","useCallback","factory","setCallProvider","setProvider","set","instance","afterInit","updateContracts","useDebounce","meta","onDestroy","getOrCreateContract","has","get","Listeners","from","map","key","useWeb3Contract","Spin","props","type","className","spinProps","indicator","React","spin","cn","s","module","exports","ABI","createAbiItem","SMART_ALPHA_DECIMALS","PriceOracleContract","this","call","BigNumber","SmartAlphaContract","epoch","currentEpoch","epoch1Start","epochDuration","epochSeniorLiquidity","epochJuniorLiquidity","epochDownsideProtectionRate","epochUpsideExposureRate","epochEntryPrice","epochSeniorTokenPrice","epochJuniorTokenPrice","queuedJuniorsUnderlyingIn","queuedJuniorsUnderlyingOut","queuedJuniorTokensBurn","queuedSeniorsUnderlyingIn","queuedSeniorsUnderlyingOut","queuedSeniorTokensBurn","estimateCurrentSeniorTokenPrice","estimateCurrentJuniorTokenPrice","feesAccrued","priceOracleContract","priceOracle","undefined","nextEpochStart","Math","max","getUnixTime","Date","now","epochsGap","plus","epochTotalLiquidityRate","div","toNumber","eq","scaleBy","multipliedBy","minus","unscaleBy","a","batch","method","priceOracleAddress","Number","callProvider","getPrice","emit","oracleSymbol","isEthAsset","result","amount","gasPrice","send","InfoTooltip","children","style","title","name","size","flexShrink","ConditionalWrapper","condition","wrapper","InternalContext","createContext","InvariantContext","VFormEmptyResolver","values","errors","VFormValidationResolver","context","validate","scheme","validationResult","getErrors","Object","keys","reduce","res","path","errKey","message","useForm","validationScheme","defaultValues","onSubmit","resolver","rhForm","rhUseForm","mode","shouldUnregister","submit","handleSubmit","assign","updateValue","fieldName","setValue","shouldDirty","shouldValidate","Form","form","disabled","ev","preventDefault","Provider","classnames","FieldLabel","label","hint","extra","text","weight","color","FormError","err","useContext","formState","FormItem","labelProps","showError","control","render","Input","id","before","dimension","rest","inputId","nanoid","isSearch","htmlFor","classNames","inputWrapper","searchIcon","input","inputSearch","AccountingModelContract","price","entryPrice","currentPrice","upsideExposureRate","totalSeniors","ZERO","downsideProtectionRate","SeniorRateModelContract","juniorLiquidity","seniorLiquidity","SENIOR_RATE_MODEL_ADDRESS","ACCOUNTING_MODEL_ADDRESS","Simulate","pool","useState","loading","setLoading","protection","setProtection","exposure","setExposure","pricePerfRate","setPricePerfRate","seniorProfitsRate","setSeniorProfitsRate","juniorProfitsRate","setJuniorProfitsRate","upsideLeverage","setUpsideLeverage","downsideLeverage","setDownsideLeverage","seniorRateModelContract","seniorRateModelAddress","accountingModelContract","accountingModelAddress","pricePerf","juniorDominance","rules","min","decimals","decimalPlaces","POSITIVE_INFINITY","messages","pricePerformance","getRates","Promise","all","calcSeniorProfits","calcJuniorProfits","seniorProfits","juniorProfits","seniorEnd","seniorValueStart","seniorValueEnd","juniorEnd","juniorValueStart","juniorValueEnd","field","placeholder","onChange","variation","cards","spinning","formatPercent","toFormat","tooltip","ResponsiveContainer","width","height","BarChart","data","CartesianGrid","strokeDasharray","vertical","YAxis","axisLine","tickLine","tickFormatter","Bar","dataKey","fill","radius","Legend","content","payload","legend","entry","idx","legendItem","legendTitle","SimulateEpoch","poolAddress","useParams","useFetchPool","useTokens","getToken","getAsset","smartAlphaContract","onUpdateData","margin","poolToken","symbol","oracleToken","oracleAssetSymbol","to","icon","iconPosition","iconRotate","bubble2Name","tag","poolName","state"],"mappings":"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","file":"static/js/sa-simulate-epoch-view.42079e12.chunk.js","sourcesContent":["import React, { ReactElement, useCallback, useEffect, useMemo, useRef } from 'react';\nimport useDebounce from '@rooks/use-debounce';\nimport isEqual from 'lodash/isEqual';\nimport ContractListener from 'web3/components/contract-listener';\nimport Erc20Contract from 'web3/erc20Contract';\nimport Web3Contract from 'web3/web3Contract';\n\nimport { useWeb3 } from 'components/providers/web3Provider';\nimport { useWallet } from 'wallets/walletProvider';\n\nimport { useContractManager } from '../web3/components/contractManagerProvider';\nimport { useReload } from './useReload';\n\nfunction useDeepCompareMemoize(value: any): typeof value {\n  const ref = useRef();\n\n  if (!isEqual(value, ref.current)) {\n    ref.current = value;\n  }\n\n  return ref.current;\n}\n\nexport const useContract = (\n  address: string | undefined,\n  {\n    loadBalance,\n    loadCommon,\n    loadAllowance,\n  }: { loadBalance?: boolean; loadCommon?: boolean; loadAllowance?: string[] } = {},\n): Erc20Contract | null => {\n  const { provider, account } = useWallet();\n  const [reload] = useReload();\n  const { getContract } = useContractManager();\n\n  const contract = useMemo(() => {\n    if (!address) {\n      return null;\n    }\n\n    const contract: Erc20Contract = getContract<Erc20Contract>(address, () => {\n      return new Erc20Contract([], address);\n    }); // (getTokenByAddress(address)?.contract as Erc20Contract) ?? new Erc20Contract([], address);\n    contract.on(Web3Contract.UPDATE_DATA, reload);\n\n    return contract;\n  }, [address, provider, reload]);\n\n  useEffect(() => {\n    if (contract && loadBalance) {\n      contract.setAccount(account);\n      contract.loadBalance();\n    }\n  }, [contract, loadBalance, account]);\n\n  useEffect(() => {\n    if (contract && loadCommon) {\n      contract\n        .loadCommon()\n        .then(() => reload())\n        .catch(Error);\n    }\n  }, [contract, loadCommon, reload]);\n\n  const memoisedAllowance = useDeepCompareMemoize(loadAllowance);\n\n  useEffect(() => {\n    if (contract && memoisedAllowance) {\n      if (Array.isArray(memoisedAllowance)) {\n        memoisedAllowance.forEach(i => contract.loadAllowance(i));\n      } else {\n        contract.loadAllowance(memoisedAllowance);\n      }\n    }\n  }, [contract, memoisedAllowance]);\n\n  return contract;\n};\n\nexport type UseContractOptions<T extends Web3Contract> = {\n  afterInit?: (contract: T) => void;\n  onDestroy?: (contract: T) => void;\n};\n\nexport type UseContractFactoryType = {\n  getOrCreateContract<T extends Web3Contract>(address: string, factory?: () => T, options?: UseContractOptions<T>): T;\n  getContract<T extends Web3Contract>(address: string): T | undefined;\n  Listeners: ReactElement | null;\n};\n\ntype CachedContractType = {\n  address: string;\n  factory: () => Web3Contract;\n  options?: UseContractOptions<Web3Contract>;\n  instance: Web3Contract;\n};\n\nexport type UseContractFactoryOptions = {\n  listeners?: boolean;\n};\n\nexport function useContractFactory(options?: UseContractFactoryOptions): UseContractFactoryType {\n  const { listeners = true } = options ?? {};\n  const { account, provider: walletProvider } = useWallet();\n  const { activeProvider } = useWeb3();\n  const [reload, version] = useReload();\n\n  const activeProviderRef = useRef(activeProvider);\n  const walletProviderRef = useRef(walletProvider);\n  const accountRef = useRef(account);\n\n  const contractsRef = useRef<Map<string, CachedContractType>>(new Map());\n\n  const createContract = useCallback(\n    (address: string, factory: () => Web3Contract, options?: UseContractOptions<Web3Contract>): Web3Contract => {\n      const contract = factory();\n      contract.setCallProvider(activeProviderRef.current);\n      contract.setProvider(walletProviderRef.current);\n      contract.setAccount(accountRef.current);\n\n      contractsRef.current.set(address, {\n        address,\n        factory,\n        options,\n        instance: contract,\n      });\n\n      options?.afterInit?.(contract);\n      reload();\n\n      return contract;\n    },\n    [activeProvider, account, reload],\n  );\n\n  const updateContracts = useDebounce(() => {\n    contractsRef.current.forEach(meta => {\n      meta.options?.onDestroy?.(meta.instance);\n      createContract(meta.address, () => meta.instance, meta.options);\n    });\n  }, 250);\n\n  if (activeProviderRef.current !== activeProvider) {\n    activeProviderRef.current = activeProvider;\n    updateContracts();\n  }\n\n  if (walletProviderRef.current !== walletProvider) {\n    walletProviderRef.current = walletProvider;\n    updateContracts();\n  }\n\n  if (accountRef.current !== account) {\n    accountRef.current = account;\n    updateContracts();\n  }\n\n  const getOrCreateContract = useCallback(\n    (address: string, factory: () => Web3Contract, options?: UseContractOptions<Web3Contract>): Web3Contract => {\n      let contract: Web3Contract;\n\n      if (contractsRef.current.has(address)) {\n        contract = contractsRef.current.get(address)!.instance;\n      } else {\n        contract = createContract(address, factory, options);\n      }\n\n      return contract;\n    },\n    [createContract],\n  );\n\n  const getContract = useCallback(\n    (address: string): Web3Contract | undefined => {\n      if (!contractsRef.current.has(address)) {\n        return undefined;\n      }\n\n      return contractsRef.current.get(address)!.instance;\n    },\n    [createContract],\n  );\n\n  const Listeners = useMemo(\n    () =>\n      listeners ? (\n        <>\n          {Array.from(contractsRef.current).map(([key, value]) => (\n            <ContractListener key={key} contract={value.instance} />\n          ))}\n        </>\n      ) : null,\n    [version, listeners],\n  );\n\n  return {\n    getOrCreateContract: getOrCreateContract as any,\n    getContract: getContract as any,\n    Listeners,\n  };\n}\n\nexport function useWeb3Contract<T extends Web3Contract>(factory: () => T, options?: UseContractOptions<T>): T {\n  return useContractFactory({ listeners: false }).getOrCreateContract<T>('$address', factory, options);\n}\n","import React from 'react';\nimport { LoadingOutlined } from '@ant-design/icons';\nimport AntdSpin, { SpinProps as AntdSpinProps } from 'antd/lib/spin';\nimport cn from 'classnames';\n\nimport s from './s.module.scss';\n\ntype Props = AntdSpinProps & {\n  type?: 'default' | 'circle';\n};\n\nconst Spin: React.FC<Props> = props => {\n  const { type = 'default', className, ...spinProps } = props;\n\n  const indicator = React.useMemo(() => {\n    switch (type) {\n      case 'circle':\n        return <LoadingOutlined spin />;\n      default:\n        break;\n    }\n\n    return undefined;\n  }, [type]);\n\n  return <AntdSpin indicator={indicator} className={cn(s.spin, className)} {...spinProps} />;\n};\n\nexport default Spin;\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"spin\":\"s_spin__1EZtC\"};","import BigNumber from 'bignumber.js';\nimport getUnixTime from 'date-fns/getUnixTime';\nimport { AbiItem } from 'web3-utils';\nimport Web3Contract, { createAbiItem } from 'web3/web3Contract';\n\nimport { isEthAsset } from 'components/providers/tokensProvider';\n\nconst ABI: AbiItem[] = [\n  // call\n  createAbiItem('epoch', [], ['uint256']),\n  createAbiItem('getCurrentEpoch', [], ['uint256']),\n  createAbiItem('epoch1Start', [], ['uint256']),\n  createAbiItem('epochDuration', [], ['uint256']),\n\n  createAbiItem('epochSeniorLiquidity', [], ['uint256']),\n  createAbiItem('epochJuniorLiquidity', [], ['uint256']),\n  createAbiItem('epochDownsideProtectionRate', [], ['uint256']),\n  createAbiItem('epochUpsideExposureRate', [], ['uint256']),\n  createAbiItem('epochEntryPrice', [], ['uint256']),\n  createAbiItem('getEpochSeniorTokenPrice', [], ['uint256']),\n  createAbiItem('getEpochJuniorTokenPrice', [], ['uint256']),\n  createAbiItem('estimateCurrentSeniorTokenPrice', [], ['uint256']),\n  createAbiItem('estimateCurrentJuniorTokenPrice', [], ['uint256']),\n\n  createAbiItem('queuedJuniorsUnderlyingIn', [], ['uint256']),\n  createAbiItem('queuedJuniorsUnderlyingOut', [], ['uint256']),\n  createAbiItem('queuedJuniorTokensBurn', [], ['uint256']),\n  createAbiItem('queuedSeniorsUnderlyingIn', [], ['uint256']),\n  createAbiItem('queuedSeniorsUnderlyingOut', [], ['uint256']),\n  createAbiItem('queuedSeniorTokensBurn', [], ['uint256']),\n\n  createAbiItem('feesAccrued', [], ['uint256']),\n  createAbiItem('priceOracle', [], ['address']),\n\n  createAbiItem('seniorEntryQueue', ['address'], ['uint256', 'uint256']),\n  createAbiItem('seniorExitQueue', ['address'], ['uint256', 'uint256']),\n  createAbiItem('juniorEntryQueue', ['address'], ['uint256', 'uint256']),\n  createAbiItem('juniorExitQueue', ['address'], ['uint256', 'uint256']),\n\n  // send\n  createAbiItem('depositJunior', ['uint256'], []),\n  createAbiItem('exitJunior', ['uint256'], []),\n  createAbiItem('redeemJuniorTokens', [], []),\n  createAbiItem('redeemJuniorUnderlying', [], []),\n  createAbiItem('depositSenior', ['uint256'], []),\n  createAbiItem('exitSenior', ['uint256'], []),\n  createAbiItem('redeemSeniorTokens', [], []),\n  createAbiItem('redeemSeniorUnderlying', [], []),\n  createAbiItem('transferFees', [], []),\n  createAbiItem('advanceEpoch', [], []),\n];\n\nexport const SMART_ALPHA_DECIMALS = 18;\n\nclass PriceOracleContract extends Web3Contract {\n  constructor(address: string) {\n    super([createAbiItem('getPrice', [], ['uint256'])], address, 'SA Price Oracle');\n  }\n\n  getPrice(): Promise<BigNumber | undefined> {\n    return this.call('getPrice').then(value => BigNumber.from(value));\n  }\n}\n\nclass SmartAlphaContract extends Web3Contract {\n  // common\n  epoch: number | undefined;\n  currentEpoch: number | undefined;\n  epoch1Start: number | undefined;\n  epochDuration: number | undefined;\n  epochSeniorLiquidity: BigNumber | undefined;\n  epochJuniorLiquidity: BigNumber | undefined;\n  epochDownsideProtectionRate: BigNumber | undefined;\n  epochUpsideExposureRate: BigNumber | undefined;\n  epochEntryPrice: BigNumber | undefined;\n  epochSeniorTokenPrice: BigNumber | undefined;\n  epochJuniorTokenPrice: BigNumber | undefined;\n  queuedJuniorsUnderlyingIn: BigNumber | undefined;\n  queuedJuniorsUnderlyingOut: BigNumber | undefined;\n  queuedJuniorTokensBurn: BigNumber | undefined;\n  queuedSeniorsUnderlyingIn: BigNumber | undefined;\n  queuedSeniorsUnderlyingOut: BigNumber | undefined;\n  queuedSeniorTokensBurn: BigNumber | undefined;\n  estimateCurrentSeniorTokenPrice: BigNumber | undefined;\n  estimateCurrentJuniorTokenPrice: BigNumber | undefined;\n  feesAccrued: BigNumber | undefined;\n  priceOracleContract: PriceOracleContract | undefined;\n  priceOracle: BigNumber | undefined;\n\n  constructor(address: string) {\n    super(ABI, address, 'Smart Alpha');\n  }\n\n  // computed\n  get nextEpochStart(): number | undefined {\n    if (this.currentEpoch === undefined || this.epochDuration === undefined || this.epoch1Start === undefined) {\n      return undefined;\n    }\n\n    return this.epoch1Start + this.currentEpoch * this.epochDuration;\n  }\n\n  get tillNextEpoch(): number | undefined {\n    const nextEpochStart = this.nextEpochStart;\n\n    if (nextEpochStart === undefined) {\n      return undefined;\n    }\n\n    return Math.max(0, nextEpochStart - getUnixTime(Date.now()));\n  }\n\n  get epochsGap(): number | undefined {\n    if (this.epoch === undefined || this.currentEpoch === undefined) {\n      return undefined;\n    }\n\n    return this.currentEpoch - this.epoch;\n  }\n\n  get requireEpochAdvance(): boolean {\n    const epochsGap = this.epochsGap;\n    return epochsGap !== undefined && epochsGap > 0;\n  }\n\n  get epochTotalLiquidityRate(): BigNumber | undefined {\n    if (!this.epochSeniorLiquidity || !this.epochJuniorLiquidity) {\n      return undefined;\n    }\n\n    return this.epochSeniorLiquidity.plus(this.epochJuniorLiquidity);\n  }\n\n  get epochSeniorLiquidityRate(): number | undefined {\n    if (!this.epochSeniorLiquidity || !this.epochTotalLiquidityRate) {\n      return undefined;\n    }\n\n    return this.epochSeniorLiquidity.div(this.epochTotalLiquidityRate).toNumber();\n  }\n\n  get epochJuniorLiquidityRate(): number | undefined {\n    if (!this.epochJuniorLiquidity || !this.epochTotalLiquidityRate) {\n      return undefined;\n    }\n\n    return this.epochJuniorLiquidity.div(this.epochTotalLiquidityRate).toNumber();\n  }\n\n  get epochUpsideLeverage(): BigNumber | undefined {\n    if (!this.epochSeniorLiquidity || !this.epochJuniorLiquidity || !this.epochUpsideExposureRate) {\n      return undefined;\n    }\n\n    if (this.epochJuniorLiquidity.eq(0)) {\n      return new BigNumber(1).scaleBy(SMART_ALPHA_DECIMALS);\n    }\n\n    return this.epochSeniorLiquidity\n      .div(this.epochJuniorLiquidity)\n      .multipliedBy(new BigNumber(1).minus(this.epochUpsideExposureRate.unscaleBy(SMART_ALPHA_DECIMALS)!))\n      .plus(1)\n      .scaleBy(SMART_ALPHA_DECIMALS);\n  }\n\n  get epochDownsideLeverage(): BigNumber | undefined {\n    if (!this.epochSeniorLiquidity || !this.epochJuniorLiquidity) {\n      return undefined;\n    }\n\n    if (this.epochJuniorLiquidity.eq(0)) {\n      return new BigNumber(1).scaleBy(SMART_ALPHA_DECIMALS);\n    }\n\n    return this.epochSeniorLiquidity.div(this.epochJuniorLiquidity).plus(1).scaleBy(SMART_ALPHA_DECIMALS);\n  }\n\n  async loadCommon() {\n    const [\n      epoch,\n      currentEpoch,\n      epoch1Start,\n      epochDuration,\n      epochSeniorLiquidity,\n      epochJuniorLiquidity,\n      epochDownsideProtectionRate,\n      epochUpsideExposureRate,\n      epochEntryPrice,\n      epochSeniorTokenPrice,\n      epochJuniorTokenPrice,\n      queuedJuniorsUnderlyingIn,\n      queuedJuniorsUnderlyingOut,\n      queuedJuniorTokensBurn,\n      queuedSeniorsUnderlyingIn,\n      queuedSeniorsUnderlyingOut,\n      queuedSeniorTokensBurn,\n      estimateCurrentSeniorTokenPrice,\n      estimateCurrentJuniorTokenPrice,\n      priceOracleAddress,\n    ] = await this.batch([\n      { method: 'epoch' },\n      { method: 'getCurrentEpoch' },\n      { method: 'epoch1Start' },\n      { method: 'epochDuration' },\n      { method: 'epochSeniorLiquidity' },\n      { method: 'epochJuniorLiquidity' },\n      { method: 'epochDownsideProtectionRate' },\n      { method: 'epochUpsideExposureRate' },\n      { method: 'epochEntryPrice' },\n      { method: 'getEpochSeniorTokenPrice' },\n      { method: 'getEpochJuniorTokenPrice' },\n      { method: 'queuedJuniorsUnderlyingIn' },\n      { method: 'queuedJuniorsUnderlyingOut' },\n      { method: 'queuedJuniorTokensBurn' },\n      { method: 'queuedSeniorsUnderlyingIn' },\n      { method: 'queuedSeniorsUnderlyingOut' },\n      { method: 'queuedSeniorTokensBurn' },\n      { method: 'estimateCurrentSeniorTokenPrice' },\n      { method: 'estimateCurrentJuniorTokenPrice' },\n      { method: 'priceOracle' },\n    ]);\n\n    this.epoch = Number(epoch);\n    this.currentEpoch = Number(currentEpoch);\n    this.epoch1Start = Number(epoch1Start);\n    this.epochDuration = Number(epochDuration);\n    this.epochSeniorLiquidity = BigNumber.from(epochSeniorLiquidity);\n    this.epochJuniorLiquidity = BigNumber.from(epochJuniorLiquidity);\n    this.epochDownsideProtectionRate = BigNumber.from(epochDownsideProtectionRate);\n    this.epochUpsideExposureRate = BigNumber.from(epochUpsideExposureRate);\n    this.epochEntryPrice = BigNumber.from(epochEntryPrice);\n    this.epochSeniorTokenPrice = BigNumber.from(epochSeniorTokenPrice);\n    this.epochJuniorTokenPrice = BigNumber.from(epochJuniorTokenPrice);\n    this.queuedJuniorsUnderlyingIn = BigNumber.from(queuedJuniorsUnderlyingIn);\n    this.queuedJuniorsUnderlyingOut = BigNumber.from(queuedJuniorsUnderlyingOut);\n    this.queuedJuniorTokensBurn = BigNumber.from(queuedJuniorTokensBurn);\n    this.queuedSeniorsUnderlyingIn = BigNumber.from(queuedSeniorsUnderlyingIn);\n    this.queuedSeniorsUnderlyingOut = BigNumber.from(queuedSeniorsUnderlyingOut);\n    this.queuedSeniorTokensBurn = BigNumber.from(queuedSeniorTokensBurn);\n    this.estimateCurrentSeniorTokenPrice = BigNumber.from(estimateCurrentSeniorTokenPrice);\n    this.estimateCurrentJuniorTokenPrice = BigNumber.from(estimateCurrentJuniorTokenPrice);\n    this.priceOracleContract = new PriceOracleContract(priceOracleAddress);\n    this.priceOracleContract.setCallProvider(this.callProvider);\n    this.priceOracle = await this.priceOracleContract.getPrice();\n    this.emit(Web3Contract.UPDATE_DATA);\n  }\n\n  getEntryPriceDecimals(oracleSymbol: string) {\n    return isEthAsset(oracleSymbol) ? 18 : 8;\n  }\n\n  seniorEntryQueue(address: string): Promise<[number, BigNumber | undefined]> {\n    return this.call('seniorEntryQueue', [address], {}).then(result => [Number(result[0]), BigNumber.from(result[1])]);\n  }\n\n  seniorExitQueue(address: string): Promise<[number, BigNumber | undefined]> {\n    return this.call('seniorExitQueue', [address], {}).then(result => [Number(result[0]), BigNumber.from(result[1])]);\n  }\n\n  juniorEntryQueue(address: string): Promise<[number, BigNumber | undefined]> {\n    return this.call('juniorEntryQueue', [address], {}).then(result => [Number(result[0]), BigNumber.from(result[1])]);\n  }\n\n  juniorExitQueue(address: string): Promise<[number, BigNumber | undefined]> {\n    return this.call('juniorExitQueue', [address], {}).then(result => [Number(result[0]), BigNumber.from(result[1])]);\n  }\n\n  getFeesAccrued(): Promise<BigNumber | undefined> {\n    return this.call('feesAccrued', [], {}).then(result => {\n      this.feesAccrued = BigNumber.from(result);\n      this.emit(Web3Contract.UPDATE_DATA);\n      return this.feesAccrued;\n    });\n  }\n\n  async depositJunior(amount: BigNumber, gasPrice?: number): Promise<void> {\n    await this.send('depositJunior', [amount], {}, gasPrice);\n  }\n\n  async withdrawJunior(amount: BigNumber, gasPrice?: number): Promise<void> {\n    await this.send('exitJunior', [amount], {}, gasPrice);\n  }\n\n  async redeemJuniorTokens(gasPrice?: number): Promise<void> {\n    await this.send('redeemJuniorTokens', [], {}, gasPrice);\n  }\n\n  async redeemJuniorUnderlying(gasPrice?: number): Promise<void> {\n    await this.send('redeemJuniorUnderlying', [], {}, gasPrice);\n  }\n\n  async depositSenior(amount: BigNumber, gasPrice?: number): Promise<void> {\n    await this.send('depositSenior', [amount], {}, gasPrice);\n  }\n\n  async withdrawSenior(amount: BigNumber, gasPrice?: number): Promise<void> {\n    await this.send('exitSenior', [amount], {}, gasPrice);\n  }\n\n  async redeemSeniorTokens(gasPrice?: number): Promise<void> {\n    await this.send('redeemSeniorTokens', [], {}, gasPrice);\n  }\n\n  async redeemSeniorUnderlying(gasPrice?: number): Promise<void> {\n    await this.send('redeemSeniorUnderlying', [], {}, gasPrice);\n  }\n\n  async transferFees(gasPrice?: number): Promise<void> {\n    await this.send('transferFees', [], {}, gasPrice);\n  }\n\n  async advanceEpoch(): Promise<void> {\n    await this.send('advanceEpoch', [], {});\n  }\n}\n\nexport default SmartAlphaContract;\n","import Tooltip from 'components/antd/tooltip';\nimport { Icon } from 'components/icon';\n\ntype PropsType = {\n  className?: string;\n  style?: React.CSSProperties;\n};\n\nexport const InfoTooltip: React.FC<PropsType> = ({ children, className, style }) => (\n  <Tooltip title={children}>\n    <Icon\n      name=\"info\"\n      size={16}\n      className={className}\n      style={{\n        flexShrink: 0,\n        ...style,\n      }}\n    />\n  </Tooltip>\n);\n","import React, { FormEvent, ReactElement, ReactNode, createContext, useCallback, useContext } from 'react';\nimport { Controller, FieldValues, useForm as rhUseForm, UseFormReturn as rhUseFormReturn } from 'react-hook-form';\nimport { UseFormStateReturn } from 'react-hook-form/dist/types';\nimport { ControllerFieldState, ControllerRenderProps } from 'react-hook-form/dist/types/controller';\nimport { DefaultValues, UnpackNestedValue } from 'react-hook-form/dist/types/form';\nimport { Resolver, ResolverResult } from 'react-hook-form/dist/types/resolvers';\nimport { FieldPath, FieldPathValue } from 'react-hook-form/dist/types/utils';\nimport classnames from 'classnames';\nimport { validate } from 'valirator';\n\nimport { Hint, Text } from 'components/custom/typography';\nimport { CP } from 'components/types.tx';\n\nimport { InvariantContext } from 'utils/context';\n\nimport s from './s.module.scss';\n\nconst ConditionalWrapper = ({ condition, wrapper, children }) => (condition ? wrapper(children) : children);\n\ntype SchemeType = {\n  [field: string]: Record<string, any>;\n};\n\ntype FormContext = {\n  scheme?: SchemeType;\n};\n\ntype UseFormReturn<V extends FieldValues = FieldValues> = rhUseFormReturn<V> & {\n  updateValue: (fieldName: FieldPath<V>, value: UnpackNestedValue<FieldPathValue<V, FieldPath<V>>>) => void;\n  submit: () => void | Promise<void>;\n};\n\ntype InternalContextType<V extends FieldValues = FieldValues> = {\n  form: UseFormReturn<V>;\n};\n\nconst InternalContext = createContext<InternalContextType>(InvariantContext('Form'));\n\nfunction VFormEmptyResolver(values: FieldValues): ResolverResult {\n  return {\n    values,\n    errors: {},\n  };\n}\n\nexport async function VFormValidationResolver(values: FieldValues, context?: FormContext): Promise<ResolverResult> {\n  const validationResult = await validate(context?.scheme, values);\n  const errors = validationResult.getErrors();\n\n  return {\n    values,\n    errors: Object.keys(errors).reduce((res, path) => {\n      const errKey = Object.keys(errors[path])[0];\n\n      if (errKey) {\n        res[path] = {\n          type: errKey,\n          message: errors[path][errKey],\n        };\n      }\n\n      return res;\n    }, {} as Record<string, any>),\n  };\n}\n\ntype useFormProps<V extends FieldValues = FieldValues> = {\n  validationScheme?: SchemeType;\n  defaultValues?: DefaultValues<V>;\n  onSubmit: (values: UnpackNestedValue<V>) => any | Promise<any>;\n};\n\nexport function useForm<V extends FieldValues = FieldValues>(props: useFormProps<V>): UseFormReturn<V> {\n  const { validationScheme, defaultValues, onSubmit } = props;\n\n  const resolver = (validationScheme ? VFormValidationResolver : VFormEmptyResolver) as Resolver<V, FormContext>;\n\n  const rhForm = rhUseForm<V, FormContext>({\n    mode: 'all',\n    resolver,\n    context: {\n      scheme: validationScheme,\n    },\n    defaultValues,\n    shouldUnregister: true,\n  });\n\n  const submit = rhForm.handleSubmit(onSubmit);\n\n  const updateValue = (fieldName: FieldPath<V>, value: UnpackNestedValue<FieldPathValue<V, FieldPath<V>>>) => {\n    rhForm.setValue(fieldName, value, {\n      shouldDirty: true,\n      shouldValidate: true,\n    });\n  };\n\n  return Object.assign(rhForm, {\n    updateValue,\n    submit,\n  });\n}\n\nexport type FormProps<V extends FieldValues = FieldValues> = {\n  form: UseFormReturn<V>;\n  disabled?: boolean;\n};\n\nexport function Form<V extends FieldValues = FieldValues>(props: CP<FormProps<V>>) {\n  const { children, className, form, disabled = false } = props;\n\n  const handleSubmit = useCallback(\n    (ev: FormEvent) => {\n      ev.preventDefault();\n      form.submit();\n    },\n    [form.submit],\n  );\n\n  const value: InternalContextType = {\n    form: form as any,\n  };\n\n  return (\n    <InternalContext.Provider value={value as InternalContextType}>\n      <form className={classnames(s.form, className, disabled && s.disabled)} onSubmit={handleSubmit}>\n        {children}\n      </form>\n    </InternalContext.Provider>\n  );\n}\n\nexport type FieldLabelProps = {\n  label: ReactNode;\n  hint?: ReactNode;\n  extra?: ReactNode;\n};\n\nexport function FieldLabel(props: CP<FieldLabelProps>) {\n  const { children, className, label, hint, extra } = props;\n\n  return (\n    <div className={classnames('flex flow-row row-gap-8', className)}>\n      <div className=\"flex flow-col col-gap-4 justify-space-between\">\n        <div className=\"flex flow-col col-gap-4 align-center\">\n          <Hint text={hint}>\n            {typeof label === 'string' ? (\n              <Text type=\"small\" weight=\"semibold\" color=\"secondary\">\n                {label}\n              </Text>\n            ) : (\n              label\n            )}\n          </Hint>\n        </div>\n        {extra}\n      </div>\n      {children}\n    </div>\n  );\n}\n\nexport type FormErrorProps = {\n  name: string;\n  children?: ReactElement;\n};\n\nexport function FormError(props: CP<FormErrorProps>) {\n  const { children, name } = props;\n  const { form } = useContext(InternalContext);\n\n  const err = form.formState.errors[name];\n\n  if (!err) {\n    return null;\n  }\n\n  return (\n    <Text type=\"small\" weight=\"semibold\" color=\"red\">\n      {err.message ?? children}\n    </Text>\n  );\n}\n\nexport type FormItemRender = {\n  field: ControllerRenderProps<FieldValues, string>;\n  fieldState: ControllerFieldState;\n  formState: UseFormStateReturn<FieldValues>;\n};\n\nexport type FormItemProps = {\n  name: string;\n  label?: string;\n  labelProps?: Omit<FieldLabelProps, 'label'>;\n  showError?: boolean;\n  children: (field: FormItemRender) => ReactElement;\n};\n\nexport function FormItem(props: CP<FormItemProps>) {\n  const { children, name, label, labelProps = {}, showError = true, className } = props;\n  const { form } = useContext(InternalContext);\n\n  return (\n    <ConditionalWrapper\n      condition={!!label}\n      wrapper={children => (\n        <FieldLabel label={label} className={className} {...labelProps}>\n          {children}\n        </FieldLabel>\n      )}>\n      <Controller name={name} control={form.control} render={children} shouldUnregister />\n      {showError && <FormError name={name} />}\n    </ConditionalWrapper>\n  );\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"form\":\"s_form__373JW\",\"disabled\":\"s_disabled__gL2Qr\"};","import { useMemo } from 'react';\nimport classNames from 'classnames';\nimport { nanoid } from 'nanoid';\n\nimport { Icon } from 'components/icon';\n\nimport s from './s.module.scss';\n\ntype InputPropsType = React.InputHTMLAttributes<HTMLInputElement> & {\n  id?: string;\n  /** \"size\" prop sounds better, but this word already reserved in input props */\n  dimension?: 'normal' | 'large';\n  before?: React.ReactNode;\n};\n\nexport const Input: React.FC<InputPropsType> = ({ id, before, className, dimension = 'normal', ...rest }) => {\n  const inputId = useMemo(() => id ?? nanoid(), [id]);\n  const isSearch = rest.type === 'search';\n\n  return (\n    <label htmlFor={inputId} className={classNames(s.inputWrapper, className)}>\n      {before && <div className={classNames(s.before, s[dimension])}>{before}</div>}\n      {isSearch && <Icon name=\"search\" size={16} className={s.searchIcon} color=\"icon\" />}\n      <input\n        type=\"text\"\n        id={inputId}\n        className={classNames(s.input, s[dimension], {\n          [s.inputSearch]: isSearch,\n        })}\n        {...rest}\n      />\n    </label>\n  );\n};\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"inputWrapper\":\"s_inputWrapper__2SYqe\",\"input\":\"s_input__ak8Ur\",\"large\":\"s_large__RjV7F\",\"inputSearch\":\"s_inputSearch__3tqk-\",\"before\":\"s_before__lvzM0\",\"searchIcon\":\"s_searchIcon__1NFiP\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"cards\":\"s_cards__1WHxN\",\"legend\":\"s_legend__1-skQ\",\"legendItem\":\"s_legendItem__1Dh-Z\",\"legendTitle\":\"s_legendTitle__lyOUm\"};","import BigNumber from 'bignumber.js';\nimport { AbiItem } from 'web3-utils';\nimport Web3Contract, { createAbiItem } from 'web3/web3Contract';\n\nconst ABI: AbiItem[] = [\n  // call\n  createAbiItem('calcJuniorProfits', ['uint256', 'uint256', 'uint256', 'uint256', 'uint256'], ['uint256']),\n  createAbiItem('calcSeniorProfits', ['uint256', 'uint256', 'uint256', 'uint256', 'uint256'], ['uint256']),\n];\n\nclass AccountingModelContract extends Web3Contract {\n  price: BigNumber | undefined;\n\n  constructor(address: string) {\n    super(ABI, address, 'SA Chainlink Oracle');\n  }\n\n  calcJuniorProfits(\n    entryPrice: BigNumber,\n    currentPrice: BigNumber,\n    upsideExposureRate: BigNumber,\n    totalSeniors: BigNumber,\n  ): Promise<BigNumber | undefined> {\n    return this.call(\n      'calcJuniorProfits',\n      [entryPrice, currentPrice, upsideExposureRate, totalSeniors, BigNumber.ZERO],\n      {},\n    ).then(BigNumber.from);\n  }\n\n  calcSeniorProfits(\n    entryPrice: BigNumber,\n    currentPrice: BigNumber,\n    downsideProtectionRate: BigNumber,\n    totalSeniors: BigNumber,\n  ): Promise<BigNumber | undefined> {\n    return this.call(\n      'calcSeniorProfits',\n      [entryPrice, currentPrice, downsideProtectionRate, totalSeniors, BigNumber.ZERO],\n      {},\n    ).then(BigNumber.from);\n  }\n}\n\nexport default AccountingModelContract;\n","import BigNumber from 'bignumber.js';\nimport { AbiItem } from 'web3-utils';\nimport Web3Contract, { createAbiItem } from 'web3/web3Contract';\n\nconst ABI: AbiItem[] = [\n  // call\n  createAbiItem('getRates', ['uint256', 'uint256'], ['uint256', 'uint256']),\n];\n\nclass SeniorRateModelContract extends Web3Contract {\n  price: BigNumber | undefined;\n\n  constructor(address: string) {\n    super(ABI, address, 'SA Chainlink Oracle');\n  }\n\n  getRates(\n    juniorLiquidity: BigNumber,\n    seniorLiquidity: BigNumber,\n  ): Promise<[BigNumber | undefined, BigNumber | undefined]> {\n    return this.call('getRates', [juniorLiquidity, seniorLiquidity], {}).then(result => [\n      BigNumber.from(result[0]),\n      BigNumber.from(result[1]),\n    ]);\n  }\n}\n\nexport default SeniorRateModelContract;\n","import { FC, useMemo, useState } from 'react';\nimport BigNumber from 'bignumber.js';\nimport classNames from 'classnames';\nimport { Bar, BarChart, CartesianGrid, Legend, ResponsiveContainer, YAxis } from 'recharts';\nimport { formatPercent } from 'web3/utils';\n\nimport Spin from 'components/antd/spin';\nimport { Button } from 'components/button';\nimport { Form, FormItem, useForm } from 'components/custom/form';\nimport { Spinner } from 'components/custom/spinner';\nimport { InfoTooltip } from 'components/custom/tooltip';\nimport { Text } from 'components/custom/typography';\nimport { Icon } from 'components/icon';\nimport { Input } from 'components/input';\nimport { useContractFactory } from 'hooks/useContract';\nimport { PoolApiType } from 'modules/smart-alpha/api';\nimport AccountingModelContract from 'modules/smart-alpha/contracts/accountingModelContract';\nimport SeniorRateModelContract from 'modules/smart-alpha/contracts/seniorRateModelContract';\nimport { SMART_ALPHA_DECIMALS } from 'modules/smart-alpha/contracts/smartAlphaContract';\n\nimport s from './s.module.scss';\n\ntype Props = {\n  pool: PoolApiType;\n};\n\ntype FormType = {\n  pricePerf: string;\n  juniorDominance: string;\n};\n\nconst SENIOR_RATE_MODEL_ADDRESS = '0x5e42beeBbD5Be0C5Dc0F5B7d0350Da5053D041b0';\nconst ACCOUNTING_MODEL_ADDRESS = '0x978989400fd9ee1f317ca08e764198f63f5acb16';\n\nexport const Simulate: FC<Props> = ({ pool }: Props) => {\n  const [loading, setLoading] = useState<boolean>(false);\n  const [protection, setProtection] = useState<BigNumber | undefined>();\n  const [exposure, setExposure] = useState<BigNumber | undefined>();\n  const [pricePerfRate, setPricePerfRate] = useState<number | undefined>();\n  const [seniorProfitsRate, setSeniorProfitsRate] = useState<number | undefined>();\n  const [juniorProfitsRate, setJuniorProfitsRate] = useState<number | undefined>();\n  const [upsideLeverage, setUpsideLeverage] = useState<BigNumber | undefined>();\n  const [downsideLeverage, setDownsideLeverage] = useState<BigNumber | undefined>();\n\n  const { getOrCreateContract } = useContractFactory();\n\n  const seniorRateModelContract = useMemo(() => {\n    return getOrCreateContract(pool.seniorRateModelAddress ?? SENIOR_RATE_MODEL_ADDRESS, () => {\n      return new SeniorRateModelContract(pool.seniorRateModelAddress ?? SENIOR_RATE_MODEL_ADDRESS);\n    });\n  }, [pool]);\n\n  const accountingModelContract = useMemo(() => {\n    return getOrCreateContract(pool.accountingModelAddress ?? ACCOUNTING_MODEL_ADDRESS, () => {\n      return new AccountingModelContract(pool.accountingModelAddress ?? ACCOUNTING_MODEL_ADDRESS);\n    });\n  }, [pool]);\n\n  const form = useForm<FormType>({\n    defaultValues: {\n      pricePerf: '',\n      juniorDominance: '',\n    },\n    validationScheme: {\n      pricePerf: {\n        rules: {\n          min: -100,\n          decimals: (value: string) => {\n            return (BigNumber.from(value)?.decimalPlaces() ?? Number.POSITIVE_INFINITY) < SMART_ALPHA_DECIMALS;\n          },\n        },\n        messages: {\n          decimals: `Maximum ${SMART_ALPHA_DECIMALS} decimals allowed`,\n        },\n      },\n      juniorDominance: {\n        rules: {\n          min: 0,\n          max: 100,\n          decimals: (value: string) => {\n            return (BigNumber.from(value)?.decimalPlaces() ?? Number.POSITIVE_INFINITY) < SMART_ALPHA_DECIMALS;\n          },\n        },\n        messages: {\n          decimals: `Maximum ${SMART_ALPHA_DECIMALS} decimals allowed`,\n        },\n      },\n    },\n    onSubmit: async (values: FormType) => {\n      setLoading(true);\n      let exposure: BigNumber | undefined;\n      let protection: BigNumber | undefined;\n      let pricePerfRate: number | undefined;\n      let seniorProfitsRate: number | undefined;\n      let juniorProfitsRate: number | undefined;\n      let upsideLeverage: BigNumber | undefined;\n      let downsideLeverage: BigNumber | undefined;\n\n      const juniorLiquidity = BigNumber.from(values.juniorDominance)?.div(100).scaleBy(SMART_ALPHA_DECIMALS);\n      const seniorLiquidity = juniorLiquidity?.minus(new BigNumber(1).scaleBy(SMART_ALPHA_DECIMALS)!).multipliedBy(-1);\n      const pricePerformance = BigNumber.from(values.pricePerf)?.div(100).scaleBy(SMART_ALPHA_DECIMALS);\n\n      if (seniorRateModelContract && seniorLiquidity && juniorLiquidity && pricePerformance) {\n        try {\n          [exposure, protection] = await seniorRateModelContract.getRates(juniorLiquidity, seniorLiquidity);\n        } catch {}\n\n        if (protection && exposure) {\n          if (accountingModelContract && seniorLiquidity && juniorLiquidity && pricePerformance) {\n            const entryPrice = new BigNumber(1).scaleBy(SMART_ALPHA_DECIMALS)!;\n            const currentPrice = entryPrice.plus(pricePerformance);\n\n            try {\n              const [seniorProfits, juniorProfits] = await Promise.all([\n                accountingModelContract.calcSeniorProfits(entryPrice, currentPrice, protection, seniorLiquidity),\n                accountingModelContract.calcJuniorProfits(entryPrice, currentPrice, exposure, seniorLiquidity),\n              ]);\n\n              if (seniorProfits && juniorProfits) {\n                pricePerfRate = pricePerformance.unscaleBy(SMART_ALPHA_DECIMALS)!.toNumber();\n\n                const seniorEnd = seniorLiquidity.plus(seniorProfits).minus(juniorProfits);\n                const seniorValueStart = entryPrice.multipliedBy(seniorLiquidity).unscaleBy(SMART_ALPHA_DECIMALS)!;\n                const seniorValueEnd = currentPrice.multipliedBy(seniorEnd).unscaleBy(SMART_ALPHA_DECIMALS)!;\n                seniorProfitsRate = !seniorValueStart.eq(0)\n                  ? seniorValueEnd.minus(seniorValueStart).div(seniorValueStart).toNumber()\n                  : 0;\n\n                const juniorEnd = juniorLiquidity.plus(juniorProfits).minus(seniorProfits);\n                const juniorValueStart = entryPrice.multipliedBy(juniorLiquidity).unscaleBy(SMART_ALPHA_DECIMALS)!;\n                const juniorValueEnd = currentPrice.multipliedBy(juniorEnd).unscaleBy(SMART_ALPHA_DECIMALS)!;\n                juniorProfitsRate = !juniorValueStart.eq(0)\n                  ? juniorValueEnd.minus(juniorValueStart).div(juniorValueStart).toNumber()\n                  : 0;\n              }\n            } catch {}\n\n            if (!juniorLiquidity.eq(0)) {\n              upsideLeverage = seniorLiquidity\n                .div(juniorLiquidity)\n                .multipliedBy(new BigNumber(1).minus(exposure.unscaleBy(SMART_ALPHA_DECIMALS)!))\n                .plus(1);\n\n              downsideLeverage = seniorLiquidity.div(juniorLiquidity).plus(1);\n            }\n          }\n        }\n      }\n\n      setProtection(protection);\n      setExposure(exposure);\n      setPricePerfRate(pricePerfRate);\n      setSeniorProfitsRate(seniorProfitsRate);\n      setJuniorProfitsRate(juniorProfitsRate);\n      setUpsideLeverage(upsideLeverage);\n      setDownsideLeverage(downsideLeverage);\n      setLoading(false);\n    },\n  });\n\n  return (\n    <>\n      <Form form={form}>\n        <div className=\"card p-24 flex wrap col-gap-24 row-gap-16 flex-grow mb-32 align-end\">\n          <FormItem\n            name=\"pricePerf\"\n            label=\"Price performance (%)\"\n            labelProps={{ hint: 'How much the underlying assets price changed during the epoch' }}\n            className=\"flex-grow\">\n            {({ field }) => (\n              <Input\n                placeholder=\"0\"\n                dimension=\"large\"\n                before={<Icon name=\"percentage\" color=\"icon\" />}\n                className=\"flex-grow\"\n                disabled={loading}\n                value={field.value}\n                onChange={field.onChange}\n              />\n            )}\n          </FormItem>\n          <FormItem\n            name=\"juniorDominance\"\n            label=\"Junior dominance (%)\"\n            labelProps={{ hint: 'What percentage of the pool was composed of junior positions' }}\n            className=\"flex-grow\">\n            {({ field }) => (\n              <Input\n                placeholder=\"0\"\n                dimension=\"large\"\n                before={<Icon name=\"percentage\" color=\"icon\" />}\n                className=\"flex-grow\"\n                disabled={loading}\n                value={field.value}\n                onChange={field.onChange}\n              />\n            )}\n          </FormItem>\n          <Button variation=\"primary\" size=\"big\">\n            {loading && <Spinner className=\"mr-8\" />}\n            Simulate\n          </Button>\n        </div>\n      </Form>\n      <div className={s.cards}>\n        <section className=\"card\">\n          <header className=\"card-header\">\n            <Text type=\"p1\" weight=\"semibold\" color=\"primary\">\n              Epoch outcomes (before fees)\n            </Text>\n          </header>\n          <div className=\"pv-24\">\n            <Spin spinning={loading}>\n              <dl>\n                <div className=\"flex align-center mb-24 ph-24\">\n                  <dt className=\"mr-8\">\n                    <Text type=\"small\" weight=\"semibold\" color=\"secondary\" className=\"flex align-middle col-gap-4\">\n                      Senior performance\n                      <InfoTooltip>\n                        Change in the fair price of the senior token over the course of the epoch\n                      </InfoTooltip>\n                    </Text>\n                  </dt>\n                  <dd className=\"ml-auto\">\n                    <Text type=\"p1\" weight=\"semibold\" color=\"primary\">\n                      {formatPercent(seniorProfitsRate) ?? '-'}\n                    </Text>\n                  </dd>\n                </div>\n                <div className=\"flex align-center mb-24 ph-24\">\n                  <dt className=\"mr-8\">\n                    <Text type=\"small\" weight=\"semibold\" color=\"secondary\" className=\"flex align-middle col-gap-4\">\n                      Senior downside protection (Absolute %)\n                      <InfoTooltip>\n                        How much the underlying asset can decline before a senior position takes on losses.\n                      </InfoTooltip>\n                    </Text>\n                  </dt>\n                  <dd className=\"ml-auto\">\n                    <Text type=\"p1\" weight=\"bold\" color=\"primary\">\n                      {formatPercent(protection?.unscaleBy(SMART_ALPHA_DECIMALS)) ?? '-'}\n                    </Text>\n                  </dd>\n                </div>\n                <div className=\"flex align-center mb-24 ph-24\">\n                  <dt className=\"mr-8\">\n                    <Text type=\"small\" weight=\"semibold\" color=\"secondary\" className=\"flex align-middle col-gap-4\">\n                      Senior upside exposure (Relative %)\n                      <InfoTooltip>\n                        How much of every 1% move to the upside in the underlying asset a senior position will have\n                        exposure to.\n                      </InfoTooltip>\n                    </Text>\n                  </dt>\n                  <dd className=\"ml-auto\">\n                    <Text type=\"p1\" weight=\"semibold\" color=\"primary\">\n                      {formatPercent(exposure?.unscaleBy(SMART_ALPHA_DECIMALS)) ?? '-'}\n                    </Text>\n                  </dd>\n                </div>\n                <hr className=\"mb-24\" />\n                <div className=\"flex align-center mb-24 ph-24\">\n                  <dt className=\"mr-8\">\n                    <Text type=\"small\" weight=\"semibold\" color=\"secondary\" className=\"flex align-middle col-gap-4\">\n                      Junior performance\n                      <InfoTooltip>\n                        Change in the fair price of the junior token over the course of the epoch\n                      </InfoTooltip>\n                    </Text>\n                  </dt>\n                  <dd className=\"ml-auto\">\n                    <Text type=\"p1\" weight=\"semibold\" color=\"primary\">\n                      {formatPercent(juniorProfitsRate) ?? '-'}\n                    </Text>\n                  </dd>\n                </div>\n                <div className=\"flex align-center mb-24 ph-24\">\n                  <dt className=\"mr-8\">\n                    <Text type=\"small\" weight=\"semibold\" color=\"secondary\" className=\"flex align-middle col-gap-4\">\n                      Upside leverage\n                      <InfoTooltip>\n                        How much of every 1% move to the upside in the underlying asset a senior position will have\n                        exposure to.\n                      </InfoTooltip>\n                    </Text>\n                  </dt>\n                  <dd className=\"ml-auto\">\n                    <Text type=\"p1\" weight=\"semibold\" color=\"primary\">\n                      {upsideLeverage ? `${upsideLeverage.toFormat(2)}x` : '-'}\n                    </Text>\n                  </dd>\n                </div>\n                <div className=\"flex align-center ph-24\">\n                  <dt className=\"mr-8\">\n                    <Text type=\"small\" weight=\"semibold\" color=\"secondary\" className=\"flex align-middle col-gap-4\">\n                      Downside leverage\n                      <InfoTooltip>\n                        How much of every 1% move to the downside in the underlying asset a junior position will have\n                        exposure to.\n                        <br />\n                        <br />\n                        The downside leverage is only applicable until senior downside protection is fully covered, and\n                        junior losses are fully realized.\n                      </InfoTooltip>\n                    </Text>\n                  </dt>\n                  <dd className=\"ml-auto\">\n                    <Text\n                      type=\"p1\"\n                      weight=\"semibold\"\n                      color=\"primary\"\n                      tooltip=\"You have this amount of downside leverage, until the underlying token's price drops by more than the senior downside protection - after which there is no more downside leverage - or you can consider it as being 1x\">\n                      {downsideLeverage ? `${downsideLeverage.toFormat(2)}x` : '-'}\n                    </Text>\n                  </dd>\n                </div>\n              </dl>\n            </Spin>\n          </div>\n        </section>\n        <section className=\"card\">\n          <header className=\"card-header\">\n            <Text type=\"p1\" weight=\"semibold\" color=\"primary\">\n              Performance\n            </Text>\n          </header>\n          <div className=\"p-24\">\n            <Spin spinning={loading}>\n              <ResponsiveContainer width={'99%'} height={300}>\n                <BarChart\n                  data={[\n                    {\n                      pricePerfRate,\n                      seniorProfitsRate,\n                      juniorProfitsRate,\n                    },\n                  ]}>\n                  <CartesianGrid strokeDasharray=\"3 3\" vertical={false} />\n                  {/* <CartesianAxis /> */}\n                  <YAxis axisLine={false} tickLine={false} tickFormatter={value => formatPercent(value, 0) ?? ''} />\n\n                  <Bar dataKey=\"pricePerfRate\" fill=\"var(--theme-red-color)\" radius={[4, 4, 0, 0]} />\n                  <Bar dataKey=\"seniorProfitsRate\" fill=\"var(--theme-green-color)\" radius={[4, 4, 0, 0]} />\n                  <Bar dataKey=\"juniorProfitsRate\" fill=\"var(--theme-purple-color)\" radius={[4, 4, 0, 0]} />\n                  <Legend\n                    content={({ payload }) => {\n                      if (!payload) return null;\n\n                      return (\n                        <div className={s.legend}>\n                          {payload.map((entry, idx) => (\n                            <span\n                              key={idx}\n                              className={s.legendItem}\n                              style={{ '--dot-color': entry.color } as React.CSSProperties}>\n                              <div className=\"flex flow-row\">\n                                <Text\n                                  type=\"small\"\n                                  weight=\"semibold\"\n                                  color=\"secondary\"\n                                  className={classNames(s.legendTitle, 'mb-4')}>\n                                  {entry.value === 'pricePerfRate' && 'Price performance'}\n                                  {entry.value === 'seniorProfitsRate' && 'Senior performance'}\n                                  {entry.value === 'juniorProfitsRate' && 'Junior performance'}\n                                </Text>\n                                <Text type=\"p1\" weight=\"bold\" color=\"primary\">\n                                  {(entry.value === 'pricePerfRate' && formatPercent(pricePerfRate)) ?? '-%'}\n                                  {(entry.value === 'seniorProfitsRate' && formatPercent(seniorProfitsRate)) ?? '-%'}\n                                  {(entry.value === 'juniorProfitsRate' && formatPercent(juniorProfitsRate)) ?? '-%'}\n                                </Text>\n                              </div>\n                            </span>\n                          ))}\n                        </div>\n                      );\n                    }}\n                  />\n                </BarChart>\n              </ResponsiveContainer>\n            </Spin>\n          </div>\n        </section>\n      </div>\n    </>\n  );\n};\n","import { useMemo } from 'react';\nimport { useParams } from 'react-router-dom';\n\nimport { Link } from 'components/button';\nimport { Spinner } from 'components/custom/spinner';\nimport { Text } from 'components/custom/typography';\nimport { useTokens } from 'components/providers/tokensProvider';\nimport { TokenIcon } from 'components/token-icon';\nimport { useContractFactory } from 'hooks/useContract';\nimport { useReload } from 'hooks/useReload';\nimport { useFetchPool } from 'modules/smart-alpha/api';\nimport SmartAlphaContract from 'modules/smart-alpha/contracts/smartAlphaContract';\n\nimport { Simulate } from './simulate';\n\nconst SimulateEpoch = () => {\n  const { id: poolAddress } = useParams<{ id: string }>();\n  const { data: pool } = useFetchPool(poolAddress);\n  const { getToken, getAsset } = useTokens();\n  const [reload] = useReload();\n\n  const { getOrCreateContract } = useContractFactory();\n\n  const smartAlphaContract = useMemo(() => {\n    if (!pool) {\n      return;\n    }\n\n    return getOrCreateContract(\n      pool.poolAddress,\n      () => {\n        return new SmartAlphaContract(pool.poolAddress);\n      },\n      {\n        afterInit: async contract => {\n          contract.onUpdateData(reload);\n          await contract.loadCommon();\n        },\n      },\n    );\n  }, [pool]);\n\n  if (!pool) {\n    return <Spinner style={{ margin: 'auto' }} />;\n  }\n\n  const poolToken = getToken(pool.poolToken.symbol);\n  const oracleToken = getAsset(pool.oracleAssetSymbol);\n\n  return (\n    <div className=\"container-limit\">\n      <div className=\"mb-16\">\n        <Link\n          to={`/smart-alpha/pools/${poolAddress}`}\n          variation=\"text-alt\"\n          icon=\"arrow\"\n          iconPosition=\"left\"\n          iconRotate={180}>\n          Pool details\n        </Link>\n      </div>\n      <div className=\"flex align-center mb-40\">\n        <TokenIcon name={poolToken?.icon} size={40} bubble2Name={oracleToken?.icon} className=\"mr-16\" />\n        <div>\n          <Text type=\"p1\" weight=\"semibold\" color=\"primary\" tag=\"h2\" className=\"mb-4\">\n            {pool.poolName}\n          </Text>\n          <Text type=\"small\" weight=\"semibold\" color=\"secondary\">\n            Epoch {smartAlphaContract?.epoch ?? pool.state.epoch ?? '-'}\n          </Text>\n        </div>\n      </div>\n      <Simulate pool={pool} />\n    </div>\n  );\n};\n\nexport default SimulateEpoch;\n"],"sourceRoot":""}